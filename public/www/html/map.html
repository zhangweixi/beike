<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
		#allmap{height:80vh;width:100%;}
		#r-result{width:100%;}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=zZSGyxZgUytdiKG135BcnaP6"></script>
	<script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>

	<title>添加/删除覆盖物</title>
</head>
<body>
	<div id="allmap"></div>
	<div id="r-result">
		<input type="button" onclick="add_overlay();" value="添加覆盖物" />
		<input type="button" onclick="remove_overlay();" value="删除覆盖物" />
	</div>
</body>
</html>
<script type="text/javascript">
	// 百度地图API功能
	var map = new BMap.Map("allmap");
	map.enableScrollWheelZoom(true);

	//var point = new BMap.Point(116.404, 39.915);
	var point = new BMap.Point(121.246246,31.091444);
	
	map.centerAndZoom(point, 20);
	
	var marker = new BMap.Marker(new BMap.Point(121.465864,31.227412)); // 创建点


	var polyline = new BMap.Polyline([
		new BMap.Point(116.399, 39.910),
		new BMap.Point(116.405, 39.920),
		new BMap.Point(116.425, 39.900)
	], {strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5});   //创建折线
	
	var circle = new BMap.Circle(point,500,{strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5}); //创建圆
	
	var polygon = new BMap.Polygon([
		new BMap.Point(116.387112,39.920977),
		new BMap.Point(116.385243,39.913063),
		new BMap.Point(116.394226,39.917988),
		new BMap.Point(116.401772,39.921364),
		new BMap.Point(116.41248,39.927893)
	], {strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5});  //创建多边形
	
	var pStart = new BMap.Point(116.392214,39.918985);
	var pEnd = new BMap.Point(116.41478,39.911901);
	var rectangle = new BMap.Polygon([
		new BMap.Point(pStart.lng,pStart.lat),
		new BMap.Point(pEnd.lng,pStart.lat),
		new BMap.Point(pEnd.lng,pEnd.lat),
		new BMap.Point(pStart.lng,pEnd.lat)
	], {strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5});  //创建矩形
	


	var sy = new BMap.Symbol(BMap_Symbol_SHAPE_BACKWARD_OPEN_ARROW, {
	    scale: 0.6,//图标缩放大小
	    strokeColor:'#fff',//设置矢量图标的线填充颜色
	    strokeWeight: '2',//设置线宽
	});
	var icons = new BMap.IconSequence(sy, '10', '30');



	//添加覆盖物
	function add_overlay(){
		//map.addOverlay(marker);            //增加点


		//map.addOverlay(polyline);          //增加折线
		//map.addOverlay(circle);            //增加圆
		//map.addOverlay(polygon);           //增加多边形
		//map.addOverlay(rectangle);         //增加矩形
		var url = "/gps-111.json?callback=success";

		// $.getJSON(url + "?jsoncallback=success", function(data) {
    
		//    console.log(data);
		// });


		$.ajax({
			url: url,	
			type: "GET",
			//dataType: "jsonp", //指定服务器返回的数据类型
			success: function (data) {
					
				//console.log(data);
				var length = data.lat.length;

				var lats = data.lat;
				var lons = data.lon;
				var points = [];
				
				
				for(var i =0;i<length ;i++){

					if(lons[i] == "") continue;

					points.push(new BMap.Point(lons[i]/100,lats[i]/100));
				}
			

			
			var polyline =new BMap.Polyline(points, {
				enableEditing: false,//是否启用线编辑，默认为false
				enableClicking: true,//是否响应点击事件，默认为true
			   	icons:[icons],
				strokeWeight:'2',//折线的宽度，以像素为单位
				strokeOpacity: 0.8,//折线的透明度，取值范围0 - 1
				strokeColor:"#18a45b" //折线颜色
			});
			map.addOverlay(polyline);
			

			return ;

				var j = 0;

				var timer = setInterval(function(){
						
						if(j == points.length){
							
							clearInterval(timer);
							return;
						}
						console.log(points[j]);
						map.addOverlay(new BMap.Marker(points[j]));
						j++;

				},200);

				
				
			}
		});
	}

	function success(){
		alert();
	}



	//清除覆盖物
	function remove_overlay(){
		map.clearOverlays();         
	}
</script>
